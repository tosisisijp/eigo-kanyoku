---
description:
globs:
alwaysApply: false
---
# Obsidian_to_Ankiå°‚ç”¨PowerShellæ“ä½œ

## ç›®çš„
- Obsidian_to_Ankiç‹¬è‡ªå½¢å¼ã®å“è³ªåŸºæº–ã‚’æº€ãŸã™ãŸã‚ã®å°‚ç”¨PowerShellæ“ä½œ
- START/ENDãƒ–ãƒ­ãƒƒã‚¯æ¤œè¨¼ã®è‡ªå‹•åŒ–
- ENDãƒãƒ¼ã‚«ãƒ¼å¾Œã®LFå¿…é ˆåˆ¤å®š
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³èªè­˜å¯èƒ½ãªå½¢å¼ã¸ã®ä¿®æ­£æ”¯æ´

## å‰ææ¡ä»¶
- [[202-Obsidian_to_Ankiç‹¬è‡ªå½¢å¼ç®¡ç†.mdc]] ã®å“è³ªåŸºæº–ã«å®Œå…¨æº–æ‹ 
- [[110-PowerShellæ“ä½œç®¡ç†.mdc]] ã®åŸºæœ¬æ“ä½œã‚’æ´»ç”¨ï¼ˆæ—§103çµ±åˆï¼‰
- Windowsç’°å¢ƒã§ã®LFæ”¹è¡Œã‚³ãƒ¼ãƒ‰çµ±ä¸€

## Obsidian_to_Ankiå½¢å¼æ¤œè¨¼

### å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨æ¤œè¨¼
```powershell
# Obsidian_to_Ankiå½¢å¼ã®å®Œå…¨æ¤œè¨¼é–¢æ•°
function Test-ObsidianToAnkiFile {
    param([string]$FilePath)
    
    Write-Host "=== $FilePath ã®æ¤œè¨¼ ===" -ForegroundColor Yellow
    
    if (-not (Test-Path $FilePath)) {
        Write-Host "âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“" -ForegroundColor Red
        return $false
    }
    
    $content = Get-Content $FilePath -Raw
    $isValid = $true
    
    # 1. Obsidian_to_Ankiã‚»ã‚¯ã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
    if ($content -match "# Obsidian_to_Anki") {
        Write-Host "âœ… Obsidian_to_Ankiã‚»ã‚¯ã‚·ãƒ§ãƒ³: å­˜åœ¨" -ForegroundColor Green
        
        # 2. START/ENDãƒãƒ¼ã‚«ãƒ¼ç¢ºèª
        $hasStart = $content -match "START"
        $hasEnd = $content -match "END"
        
        if ($hasStart) { 
            Write-Host "âœ… STARTãƒãƒ¼ã‚«ãƒ¼: å­˜åœ¨" -ForegroundColor Green 
        } else { 
            Write-Host "âŒ STARTãƒãƒ¼ã‚«ãƒ¼: ä¸å­˜åœ¨" -ForegroundColor Red
            $isValid = $false
        }
        
        if ($hasEnd) { 
            Write-Host "âœ… ENDãƒãƒ¼ã‚«ãƒ¼: å­˜åœ¨" -ForegroundColor Green
            
            # 3. ENDãƒãƒ¼ã‚«ãƒ¼å¾Œã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ç¢ºèªï¼ˆObsidian_to_Ankiå°‚ç”¨è¦ä»¶ï¼‰
            $endIndex = $content.LastIndexOf("END")
            if ($endIndex -ge 0) {
                Write-Host "ğŸ“ ENDãƒãƒ¼ã‚«ãƒ¼ä½ç½®: $endIndex" -ForegroundColor Cyan
                $afterEndStart = $endIndex + 3
                $remainingLength = $content.Length - $afterEndStart
                
                # â­ Obsidian_to_Ankiå°‚ç”¨åˆ¤å®š: ENDã®å¾Œã«LFå¿…é ˆ
                if ($remainingLength -eq 0) {
                    Write-Host "âŒ ENDãŒãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ï¼ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³èªè­˜ä¸å¯ï¼‰" -ForegroundColor Red
                    Write-Host "   â†’ ENDã®å¾Œã«LFæ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒå¿…è¦" -ForegroundColor Yellow
                    $isValid = $false
                } else {
                    $afterEnd = $content.Substring($afterEndStart, [Math]::Min(5, $remainingLength))
                    $bytes = [System.Text.Encoding]::UTF8.GetBytes($afterEnd)
                    
                    Write-Host "ğŸ“‹ ENDã®å¾Œã®æ–‡å­—:" -ForegroundColor Cyan
                    for ($i = 0; $i -lt $bytes.Length; $i++) {
                        $char = $bytes[$i]
                        $hex = "{0:X2}" -f $char
                        $ascii = if ($char -ge 32 -and $char -le 126) { [char]$char } else { "." }
                        
                        $status = switch ($hex) {
                            "20" { "âŒ ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆé™¤å»å¿…è¦ï¼‰"; $isValid = $false }
                            "0D" { "âœ… CRï¼ˆæ­£å¸¸ï¼‰" }
                            "0A" { "âœ… LFï¼ˆæ­£å¸¸ï¼‰" }
                            default { "âš ï¸ ãã®ä»–ã®æ–‡å­—"; $isValid = $false }
                        }
                        
                        Write-Host "  END+$($i+1): $hex ($ascii) $status"
                    }
                    
                    # 4. LFå½¢å¼ç¢ºèªï¼ˆObsidian_to_Ankiå¿…é ˆè¦ä»¶ï¼‰
                    if ($bytes.Length -ge 1 -and $bytes[0] -eq 0x0A) {
                        Write-Host "âœ… LFæ”¹è¡Œã‚³ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³èªè­˜å¯èƒ½ï¼‰" -ForegroundColor Green
                    } elseif ($bytes.Length -ge 2 -and $bytes[0] -eq 0x0D -and $bytes[1] -eq 0x0A) {
                        Write-Host "âŒ CRLFã‚ã‚Šï¼ˆLFçµ±ä¸€ãŒå¿…è¦ï¼‰" -ForegroundColor Red
                        $isValid = $false
                    } elseif ($bytes.Length -ge 1 -and $bytes[0] -eq 0x20) {
                        Write-Host "âŒ ENDã®ç›´å¾Œã«ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆé™¤å»ãŒå¿…è¦ï¼‰" -ForegroundColor Red
                        $isValid = $false
                    }
                }
            }
        } else { 
            Write-Host "âŒ ENDãƒãƒ¼ã‚«ãƒ¼: ä¸å­˜åœ¨" -ForegroundColor Red
            $isValid = $false
        }
        
        # 5. WithSpeechç¢ºèª
        if ($content -match "WithSpeech") {
            Write-Host "âœ… WithSpeech: å­˜åœ¨" -ForegroundColor Green
        } else {
            Write-Host "âš ï¸ WithSpeech: ä¸å­˜åœ¨ï¼ˆæ¨å¥¨ï¼‰" -ForegroundColor Yellow
        }
        
        # 6. é‡è¤‡æ¤œå‡ºï¼ˆ202ç•ªãƒ«ãƒ¼ãƒ«æº–æ‹ ï¼‰
        $obsidianToAnkiCount = ($content | Select-String -Pattern "# Obsidian_to_Anki" -AllMatches).Matches.Count
        $startCount = ($content | Select-String -Pattern "^START" -AllMatches).Matches.Count
        $endCount = ($content | Select-String -Pattern "^END" -AllMatches).Matches.Count
        
        Write-Host "ğŸ“Š é‡è¤‡æ¤œå‡ºçµæœ:" -ForegroundColor Cyan
        Write-Host "  # Obsidian_to_Anki ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ•°: $obsidianToAnkiCount"
        Write-Host "  START ãƒãƒ¼ã‚«ãƒ¼æ•°: $startCount"
        Write-Host "  END ãƒãƒ¼ã‚«ãƒ¼æ•°: $endCount"
        
        if ($obsidianToAnkiCount -gt 1) {
            Write-Host "âŒ Obsidian_to_Ankiã‚»ã‚¯ã‚·ãƒ§ãƒ³é‡è¤‡ ($obsidianToAnkiCount å€‹)" -ForegroundColor Red
            $isValid = $false
        } elseif ($startCount -ne $endCount) {
            Write-Host "âŒ START/ENDãƒãƒ¼ã‚«ãƒ¼æ•°ä¸ä¸€è‡´ (START:$startCount, END:$endCount)" -ForegroundColor Red
            $isValid = $false
        } elseif ($startCount -gt 1) {
            Write-Host "âŒ START/ENDãƒšã‚¢é‡è¤‡ ($startCount çµ„)" -ForegroundColor Red
            $isValid = $false
        } else {
            Write-Host "âœ… é‡è¤‡ãªã—ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³:$obsidianToAnkiCount, START/END:$startCountçµ„ï¼‰" -ForegroundColor Green
        }
        
        # 7. IDé‡è¤‡æ¤œå‡º
        $idMatches = $content | Select-String -Pattern "<!--ID: (\d+)-->" -AllMatches
        if ($idMatches.Matches.Count -gt 1) {
            Write-Host "âŒ IDé‡è¤‡æ¤œå‡º ($($idMatches.Matches.Count) å€‹)" -ForegroundColor Red
            $idMatches.Matches | ForEach-Object { Write-Host "  ID: $($_.Groups[1].Value)" }
            $isValid = $false
        } elseif ($idMatches.Matches.Count -eq 1) {
            Write-Host "âœ… ID: $($idMatches.Matches[0].Groups[1].Value)" -ForegroundColor Green
        } else {
            Write-Host "âš ï¸ IDæœªç”Ÿæˆï¼ˆåˆå›åŒæœŸå¾…ã¡ï¼‰" -ForegroundColor Yellow
        }
        
    } else {
        Write-Host "âš ï¸ Obsidian_to_Ankiã‚»ã‚¯ã‚·ãƒ§ãƒ³: å­˜åœ¨ã—ãªã„" -ForegroundColor Yellow
        return $false  # ã‚»ã‚¯ã‚·ãƒ§ãƒ³è‡ªä½“ãŒãªã„å ´åˆã¯æ¤œè¨¼å¯¾è±¡å¤–
    }
    
    Write-Host ""
    return $isValid
}

# ä½¿ç”¨ä¾‹
# Test-ObsidianToAnkiFile "example.md"
```

### è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€æ‹¬æ¤œè¨¼
```powershell
# Obsidian_to_Ankiå½¢å¼ã®ä¸€æ‹¬æ¤œè¨¼
function Test-AllObsidianToAnkiFiles {
    # 110ç•ªãƒ«ãƒ¼ãƒ«ã®åŸºæœ¬æ“ä½œã‚’æ´»ç”¨ï¼ˆæ—§103çµ±åˆï¼‰
    $mdFiles = Get-ChildItem -Path "." -Filter "*.md" | Where-Object { $_.Name -notlike "README.md" }
    
    Write-Host "=== Obsidian_to_Ankiå½¢å¼ ä¸€æ‹¬æ¤œè¨¼é–‹å§‹ ===" -ForegroundColor Magenta
    Write-Host "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«æ•°: $($mdFiles.Count)" -ForegroundColor Magenta
    Write-Host ""
    
    # Obsidian_to_Ankiå°‚ç”¨ã®çµæœåˆ†é¡
    $results = @{
        "æ­£å¸¸" = @()
        "ENDã‚¹ãƒšãƒ¼ã‚¹å•é¡Œ" = @()
        "æ”¹è¡Œã‚³ãƒ¼ãƒ‰å•é¡Œ" = @()
        "ENDãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾å•é¡Œ" = @()  # â­ Obsidian_to_Ankiå°‚ç”¨
        "ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸å­˜åœ¨" = @()
        "ãƒãƒ¼ã‚«ãƒ¼ä¸å­˜åœ¨" = @()
        "ãã®ä»–å•é¡Œ" = @()
    }
    
    foreach ($file in $mdFiles) {
        $content = Get-Content $file.FullName -Raw
        
        if ($content -match "# Obsidian_to_Anki") {
            if ($content -match "END") {
                $endIndex = $content.LastIndexOf("END")
                $afterEndStart = $endIndex + 3
                $remainingLength = $content.Length - $afterEndStart
                
                # â­ Obsidian_to_Ankiå°‚ç”¨åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
                if ($remainingLength -eq 0) {
                    $results["ENDãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾å•é¡Œ"] += $file.Name
                } else {
                    $afterEnd = $content.Substring($afterEndStart, [Math]::Min(5, $remainingLength))
                    $bytes = [System.Text.Encoding]::UTF8.GetBytes($afterEnd)
                    
                    if ($bytes.Length -ge 1 -and $bytes[0] -eq 0x20) {
                        $results["ENDã‚¹ãƒšãƒ¼ã‚¹å•é¡Œ"] += $file.Name
                    } elseif ($bytes.Length -eq 1 -and $bytes[0] -eq 0x0A) {
                        $results["æ”¹è¡Œã‚³ãƒ¼ãƒ‰å•é¡Œ"] += $file.Name
                    } elseif ($bytes.Length -ge 2 -and $bytes[0] -eq 0x0D -and $bytes[1] -eq 0x0A) {
                        $results["æ­£å¸¸"] += $file.Name
                    } else {
                        $results["ãã®ä»–å•é¡Œ"] += $file.Name
                    }
                }
            } else {
                $results["ãƒãƒ¼ã‚«ãƒ¼ä¸å­˜åœ¨"] += $file.Name
            }
        } else {
            $results["ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸å­˜åœ¨"] += $file.Name
        }
    }
    
    # Obsidian_to_Ankiå°‚ç”¨ã®çµæœè¡¨ç¤º
    Write-Host "=== Obsidian_to_Ankiæ¤œè¨¼çµæœã‚µãƒãƒªãƒ¼ ===" -ForegroundColor Magenta
    foreach ($category in $results.Keys) {
        $count = $results[$category].Count
        if ($count -gt 0) {
            $color = switch ($category) {
                "æ­£å¸¸" { "Green" }
                "ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸å­˜åœ¨" { "Yellow" }
                default { "Red" }
            }
            Write-Host "$category ($count ä»¶):" -ForegroundColor $color
            $results[$category] | ForEach-Object { Write-Host "  - $_" }
            Write-Host ""
        }
    }
    
    return $results
}

# ä½¿ç”¨ä¾‹
# $results = Test-AllObsidianToAnkiFiles
```

## Obsidian_to_Ankiå½¢å¼ä¿®æ­£

### ENDãƒãƒ¼ã‚«ãƒ¼ä¿®æ­£ï¼ˆLFè¿½åŠ ï¼‰
```powershell
# ENDãƒãƒ¼ã‚«ãƒ¼å¾Œã«LFæ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
function Add-LFAfterEND {
    param([string]$FilePath)
    
    Write-Host "ENDãƒãƒ¼ã‚«ãƒ¼å¾ŒLFè¿½åŠ : $FilePath" -ForegroundColor Yellow
    
    $content = Get-Content $FilePath -Raw
    $endIndex = $content.LastIndexOf("END")
    
    if ($endIndex -eq -1) {
        Write-Host "âŒ ENDãƒãƒ¼ã‚«ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" -ForegroundColor Red
        return $false
    }
    
    $afterEndStart = $endIndex + 3
    $remainingLength = $content.Length - $afterEndStart
    
    if ($remainingLength -eq 0) {
        # ENDãŒãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã®å ´åˆã€LFè¿½åŠ 
        $newContent = $content + "`n"
        Set-Content $FilePath -Value $newContent -NoNewline -Encoding UTF8
        Write-Host "âœ… ENDã®å¾Œã«LFè¿½åŠ å®Œäº†" -ForegroundColor Green
        return $true
    } else {
        Write-Host "âš ï¸ ENDã®å¾Œã«æ—¢ã«æ–‡å­—ãŒå­˜åœ¨ã—ã¾ã™" -ForegroundColor Yellow
        return $false
    }
}

# ä½¿ç”¨ä¾‹
# Add-LFAfterEND "example.md"
```

### ENDã‚¹ãƒšãƒ¼ã‚¹é™¤å»
```powershell
# ENDãƒãƒ¼ã‚«ãƒ¼å¾Œã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’é™¤å»
function Remove-SpaceAfterEND {
    param([string]$FilePath)
    
    Write-Host "ENDãƒãƒ¼ã‚«ãƒ¼å¾Œã‚¹ãƒšãƒ¼ã‚¹é™¤å»: $FilePath" -ForegroundColor Yellow
    
    $content = Get-Content $FilePath -Raw
    
    # "END " ã‚’ "END" ã«ç½®æ›ï¼ˆã‚¹ãƒšãƒ¼ã‚¹é™¤å»ï¼‰
    if ($content -match "END ") {
        $newContent = $content -replace "END ", "END"
        Set-Content $FilePath -Value $newContent -NoNewline -Encoding UTF8
        Write-Host "âœ… ENDã®å¾Œã®ã‚¹ãƒšãƒ¼ã‚¹é™¤å»å®Œäº†" -ForegroundColor Green
        return $true
    } else {
        Write-Host "âš ï¸ ENDã®å¾Œã«ã‚¹ãƒšãƒ¼ã‚¹ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ" -ForegroundColor Yellow
        return $false
    }
}

# ä½¿ç”¨ä¾‹
# Remove-SpaceAfterEND "example.md"
```

### ä¸€æ‹¬ä¿®æ­£å‡¦ç†
```powershell
# Obsidian_to_Ankiå½¢å¼ã®ä¸€æ‹¬ä¿®æ­£
function Repair-AllObsidianToAnkiFiles {
    param([switch]$WhatIf)  # å®Ÿéš›ã®ä¿®æ­£å‰ã®ç¢ºèªç”¨
    
    Write-Host "=== Obsidian_to_Ankiå½¢å¼ ä¸€æ‹¬ä¿®æ­£é–‹å§‹ ===" -ForegroundColor Magenta
    
    # ã¾ãšæ¤œè¨¼ã‚’å®Ÿè¡Œ
    $results = Test-AllObsidianToAnkiFiles
    
    $repairResults = @{
        "ä¿®æ­£æ¸ˆã¿" = @()
        "ä¿®æ­£ä¸è¦" = @()
        "ä¿®æ­£å¤±æ•—" = @()
    }
    
    # ENDã‚¹ãƒšãƒ¼ã‚¹å•é¡Œã®ä¿®æ­£
    foreach ($fileName in $results["ENDã‚¹ãƒšãƒ¼ã‚¹å•é¡Œ"]) {
        if ($WhatIf) {
            Write-Host "ä¿®æ­£äºˆå®š: $fileName (ENDã‚¹ãƒšãƒ¼ã‚¹é™¤å»)" -ForegroundColor Cyan
        } else {
            if (Remove-SpaceAfterEND $fileName) {
                $repairResults["ä¿®æ­£æ¸ˆã¿"] += "$fileName (ã‚¹ãƒšãƒ¼ã‚¹é™¤å»)"
            } else {
                $repairResults["ä¿®æ­£å¤±æ•—"] += "$fileName (ã‚¹ãƒšãƒ¼ã‚¹é™¤å»å¤±æ•—)"
            }
        }
    }
    
    # ENDãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾å•é¡Œã®ä¿®æ­£
    foreach ($fileName in $results["ENDãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾å•é¡Œ"]) {
        if ($WhatIf) {
            Write-Host "ä¿®æ­£äºˆå®š: $fileName (LFè¿½åŠ )" -ForegroundColor Cyan
        } else {
            if (Add-LFAfterEND $fileName) {
                $repairResults["ä¿®æ­£æ¸ˆã¿"] += "$fileName (LFè¿½åŠ )"
            } else {
                $repairResults["ä¿®æ­£å¤±æ•—"] += "$fileName (LFè¿½åŠ å¤±æ•—)"
            }
        }
    }
    
    # æ”¹è¡Œã‚³ãƒ¼ãƒ‰å•é¡Œã®ä¿®æ­£ï¼ˆ110ç•ªãƒ«ãƒ¼ãƒ«æ´»ç”¨ãƒ»æ—§103çµ±åˆï¼‰
    foreach ($fileName in $results["æ”¹è¡Œã‚³ãƒ¼ãƒ‰å•é¡Œ"]) {
        if ($WhatIf) {
            Write-Host "ä¿®æ­£äºˆå®š: $fileName (LFçµ±ä¸€)" -ForegroundColor Cyan
        } else {
            try {
                # 110ç•ªãƒ«ãƒ¼ãƒ«ã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰çµ±ä¸€å‡¦ç†ã‚’æ´»ç”¨ï¼ˆæ—§103çµ±åˆï¼‰
                $content = Get-Content $fileName -Raw
                $content = $content -replace "`r`n", "`n"
                $content = $content -replace "`n", "`r`n"
                Set-Content $fileName -Value $content -NoNewline -Encoding UTF8
                
                $repairResults["ä¿®æ­£æ¸ˆã¿"] += "$fileName (LFçµ±ä¸€)"
            } catch {
                $repairResults["ä¿®æ­£å¤±æ•—"] += "$fileName (LFçµ±ä¸€å¤±æ•—)"
            }
        }
    }
    
    # æ­£å¸¸ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¿®æ­£ä¸è¦
    foreach ($fileName in $results["æ­£å¸¸"]) {
        $repairResults["ä¿®æ­£ä¸è¦"] += $fileName
    }
    
    # ä¿®æ­£çµæœè¡¨ç¤º
    Write-Host "=== ä¿®æ­£çµæœã‚µãƒãƒªãƒ¼ ===" -ForegroundColor Magenta
    foreach ($category in $repairResults.Keys) {
        $count = $repairResults[$category].Count
        if ($count -gt 0) {
            $color = switch ($category) {
                "ä¿®æ­£ä¸è¦" { "Green" }
                "ä¿®æ­£æ¸ˆã¿" { "Cyan" }
                default { "Red" }
            }
            Write-Host "$category ($count ä»¶):" -ForegroundColor $color
            $repairResults[$category] | ForEach-Object { Write-Host "  - $_" }
            Write-Host ""
        }
    }
    
    return $repairResults
}

# ä½¿ç”¨ä¾‹
# Repair-AllObsidianToAnkiFiles -WhatIf  # ä¿®æ­£å†…å®¹ã®ç¢ºèª
# Repair-AllObsidianToAnkiFiles          # å®Ÿéš›ã®ä¿®æ­£å®Ÿè¡Œ
```

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é€£æºç¢ºèª

### æ­£è¦è¡¨ç¾ãƒãƒƒãƒãƒ³ã‚°ç¢ºèª
```powershell
# Obsidian_to_Ankiãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ­£è¦è¡¨ç¾ã¨ã®äº’æ›æ€§ç¢ºèª
function Test-PluginCompatibility {
    param([string]$FilePath)
    
    Write-Host "=== ãƒ—ãƒ©ã‚°ã‚¤ãƒ³äº’æ›æ€§ç¢ºèª: $FilePath ===" -ForegroundColor Cyan
    
    $content = Get-Content $FilePath -Raw
    
    # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä½¿ç”¨ã™ã‚‹æ­£è¦è¡¨ç¾: /^START\n([\s\S]*?\n)END/gm
    # PowerShellã§ã®è¿‘ä¼¼ãƒ‘ã‚¿ãƒ¼ãƒ³
    $pattern = "(?m)^START`n([\s\S]*?`n)END"
    
    if ($content -match $pattern) {
        Write-Host "âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ­£è¦è¡¨ç¾: ãƒãƒƒãƒæˆåŠŸ" -ForegroundColor Green
        $matchContent = $Matches[1]
        Write-Host "ğŸ“‹ ãƒãƒƒãƒã—ãŸå†…å®¹ã®é•·ã•: $($matchContent.Length) æ–‡å­—" -ForegroundColor Cyan
        
        # ãƒãƒƒãƒã—ãŸå†…å®¹ã®å…ˆé ­ãƒ»æœ«å°¾ç¢ºèª
        $preview = if ($matchContent.Length -gt 100) { 
            $matchContent.Substring(0, 50) + "..." + $matchContent.Substring($matchContent.Length - 50)
        } else { 
            $matchContent 
        }
        Write-Host "ğŸ“‹ ãƒãƒƒãƒå†…å®¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼: $preview" -ForegroundColor Cyan
        
        return $true
    } else {
        Write-Host "âŒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ­£è¦è¡¨ç¾: ãƒãƒƒãƒå¤±æ•—" -ForegroundColor Red
        Write-Host "   â†’ START/ENDãƒ–ãƒ­ãƒƒã‚¯ãŒãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«èªè­˜ã•ã‚Œã¾ã›ã‚“" -ForegroundColor Yellow
        return $false
    }
}

# ä½¿ç”¨ä¾‹
# Test-PluginCompatibility "example.md"
```

### IDç”Ÿæˆç¢ºèª
```powershell
# Obsidian_to_Ankiãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã‚ˆã‚‹IDè‡ªå‹•ç”Ÿæˆã®ç¢ºèª
function Test-IDGeneration {
    param([string]$FilePath)
    
    Write-Host "=== IDç”ŸæˆçŠ¶æ³ç¢ºèª: $FilePath ===" -ForegroundColor Cyan
    
    $content = Get-Content $FilePath -Raw
    
    # IDè¡Œã®å­˜åœ¨ç¢ºèª
    if ($content -match "<!--ID: (\d+)-->") {
        $id = $Matches[1]
        Write-Host "âœ… IDæ—¢å­˜: $id" -ForegroundColor Green
        
        # IDã®å½¢å¼ç¢ºèªï¼ˆ13æ¡ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
        if ($id.Length -eq 13 -and $id -match "^\d+$") {
            Write-Host "âœ… IDå½¢å¼: æ­£å¸¸ï¼ˆ13æ¡ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰" -ForegroundColor Green
        } else {
            Write-Host "âš ï¸ IDå½¢å¼: éæ¨™æº–" -ForegroundColor Yellow
        }
        
        return $true
    } else {
        Write-Host "âš ï¸ IDæœªç”Ÿæˆ: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åŒæœŸå¾…ã¡" -ForegroundColor Yellow
        Write-Host "   â†’ åˆå›åŒæœŸæ™‚ã«Obsidian_to_Ankiãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè‡ªå‹•ç”Ÿæˆ" -ForegroundColor Cyan
        return $false
    }
}

# ä½¿ç”¨ä¾‹
# Test-IDGeneration "example.md"
```

## çµ±åˆæ¤œè¨¼ãƒ»ä¿®æ­£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```powershell
# Obsidian_to_Ankiå½¢å¼ã®å®Œå…¨æ¤œè¨¼ãƒ»ä¿®æ­£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
function Invoke-ObsidianToAnkiWorkflow {
    param(
        [switch]$SkipBackup,
        [switch]$WhatIf
    )
    
    Write-Host "=== Obsidian_to_Anki å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–‹å§‹ ===" -ForegroundColor Magenta
    Write-Host "WhatIf ãƒ¢ãƒ¼ãƒ‰: $WhatIf" -ForegroundColor Cyan
    Write-Host ""
    
    # Step 1: äº‹å‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    if (-not $SkipBackup -and -not $WhatIf) {
        Write-Host "Step 1: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆä¸­..." -ForegroundColor Yellow
        $timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
        $backupDir = "backup_$timestamp"
        New-Item -ItemType Directory -Path $backupDir -Force | Out-Null
        
        $mdFiles = Get-ChildItem -Path "." -Filter "*.md" | Where-Object { $_.Name -notlike "README.md" }
        $mdFiles | ForEach-Object { Copy-Item $_.FullName "$backupDir\" }
        Write-Host "âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: $backupDir" -ForegroundColor Green
        Write-Host ""
    }
    
    # Step 2: ç¾çŠ¶ç¢ºèª
    Write-Host "Step 2: ç¾çŠ¶ç¢ºèª..." -ForegroundColor Yellow
    $initialResults = Test-AllObsidianToAnkiFiles
    Write-Host ""
    
    # Step 3: ä¿®æ­£å®Ÿè¡Œ
    Write-Host "Step 3: ä¿®æ­£å‡¦ç†..." -ForegroundColor Yellow
    $repairResults = Repair-AllObsidianToAnkiFiles -WhatIf:$WhatIf
    Write-Host ""
    
    # Step 4: ä¿®æ­£å¾Œç¢ºèª
    if (-not $WhatIf) {
        Write-Host "Step 4: ä¿®æ­£å¾Œç¢ºèª..." -ForegroundColor Yellow
        $finalResults = Test-AllObsidianToAnkiFiles
        Write-Host ""
        
        # Step 5: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³äº’æ›æ€§ç¢ºèª
        Write-Host "Step 5: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³äº’æ›æ€§ç¢ºèª..." -ForegroundColor Yellow
        $compatibleFiles = @()
        $mdFiles = Get-ChildItem -Path "." -Filter "*.md" | Where-Object { $_.Name -notlike "README.md" }
        
        foreach ($file in $mdFiles) {
            $content = Get-Content $file.FullName -Raw
            if ($content -match "# Obsidian_to_Anki") {
                if (Test-PluginCompatibility $file.FullName) {
                    $compatibleFiles += $file.Name
                }
            }
        }
        
        Write-Host "âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³äº’æ›: $($compatibleFiles.Count) ãƒ•ã‚¡ã‚¤ãƒ«" -ForegroundColor Green
        Write-Host ""
    }
    
    # æœ€çµ‚ã‚µãƒãƒªãƒ¼
    Write-Host "=== ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Œäº†ã‚µãƒãƒªãƒ¼ ===" -ForegroundColor Magenta
    Write-Host "åˆæœŸçŠ¶æ…‹:"
    Write-Host "  æ­£å¸¸: $($initialResults['æ­£å¸¸'].Count) ãƒ•ã‚¡ã‚¤ãƒ«"
    Write-Host "  å•é¡Œ: $(($initialResults.Values | Measure-Object -Sum Count).Sum - $initialResults['æ­£å¸¸'].Count) ãƒ•ã‚¡ã‚¤ãƒ«"
    
    if (-not $WhatIf) {
        Write-Host "ä¿®æ­£å¾Œ:"
        Write-Host "  æ­£å¸¸: $($finalResults['æ­£å¸¸'].Count) ãƒ•ã‚¡ã‚¤ãƒ«"
        Write-Host "  å•é¡Œ: $(($finalResults.Values | Measure-Object -Sum Count).Sum - $finalResults['æ­£å¸¸'].Count) ãƒ•ã‚¡ã‚¤ãƒ«"
        Write-Host "  ãƒ—ãƒ©ã‚°ã‚¤ãƒ³äº’æ›: $($compatibleFiles.Count) ãƒ•ã‚¡ã‚¤ãƒ«"
    }
}

# ä½¿ç”¨ä¾‹
# Invoke-ObsidianToAnkiWorkflow -WhatIf          # ç¢ºèªã®ã¿
# Invoke-ObsidianToAnkiWorkflow                  # å®Ÿéš›ã®ä¿®æ­£å®Ÿè¡Œ
# Invoke-ObsidianToAnkiWorkflow -SkipBackup      # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãªã—ã§å®Ÿè¡Œ
```

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- [[202-Obsidian_to_Ankiç‹¬è‡ªå½¢å¼ç®¡ç†.mdc]] - å½¢å¼å®šç¾©ãƒ»å“è³ªåŸºæº–ï¼ˆå¿…é ˆå‚ç…§ï¼‰
- [[110-PowerShellæ“ä½œç®¡ç†.mdc]] - åŸºæœ¬æ“ä½œãƒ»å…±é€šå‡¦ç†ï¼ˆæ—§103çµ±åˆï¼‰
- [[004-PowerShellæ“ä½œã‚¬ã‚¤ãƒ‰.mdc]] - æ±ç”¨PowerShellæŠ€è¡“
- [[001-AIå®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³.mdc]] - AIå®Ÿè£…æ™‚ã®åˆ¶ç´„

## é‡è¦ãªæ³¨æ„äº‹é …

### Obsidian_to_Ankiå°‚ç”¨è¦ä»¶
- **ENDã®å¾Œã«LFå¿…é ˆ**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ­£è¦è¡¨ç¾ `/^START\n([\s\S]*?\n)END/gm` ã«å¯¾å¿œ
- **IDç®¡ç†**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè‡ªå‹•ç”Ÿæˆã™ã‚‹ãŸã‚ã€æ‰‹å‹•ä½œæˆãƒ»ç·¨é›†ã¯ç¦æ­¢
- **WithSpeech**: éŸ³å£°æ©Ÿèƒ½æœ‰åŠ¹åŒ–ã®ãŸã‚æ¨å¥¨

### ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ä½¿ç”¨ç¦æ­¢
- ã“ã®ãƒ«ãƒ¼ãƒ«ã¯eigo-kanyoku + Obsidian_to_Ankiå°‚ç”¨ã§ã™
- æ±ç”¨çš„ãªPowerShellæ“ä½œã¯ [[004-PowerShellæ“ä½œã‚¬ã‚¤ãƒ‰.mdc]] ã‚’å‚ç…§
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±é€šæ“ä½œã¯ [[110-PowerShellæ“ä½œç®¡ç†.mdc]] ã‚’å‚ç…§ï¼ˆæ—§103çµ±åˆï¼‰

### å®‰å…¨æ€§ã®ç¢ºä¿
- é‡è¦ãªä¿®æ­£å‰ã¯å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
- WhatIfãƒ¢ãƒ¼ãƒ‰ã§ã®äº‹å‰ç¢ºèªã‚’æ¨å¥¨
- ä¿®æ­£å¾Œã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³äº’æ›æ€§ç¢ºèªã‚’å¿…é ˆã¨ã™ã‚‹

### é‡è¤‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¿®æ­£
```powershell
# é‡è¤‡ã—ãŸObsidian_to_Ankiã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿®æ­£
function Fix-DuplicateObsidianToAnkiSections {
    param([string]$FilePath)
    
    Write-Host "é‡è¤‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¿®æ­£: $FilePath" -ForegroundColor Yellow
    
    if (-not (Test-Path $FilePath)) {
        Write-Host "âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $FilePath" -ForegroundColor Red
        return $false
    }
    
    try {
        $content = Get-Content $FilePath -Raw
        
        # é‡è¤‡æ¤œå‡º
        $obsidianToAnkiCount = ($content | Select-String -Pattern "# Obsidian_to_Anki" -AllMatches).Matches.Count
        
        if ($obsidianToAnkiCount -le 1) {
            Write-Host "âœ… é‡è¤‡ãªã—ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³æ•°: $obsidianToAnkiCountï¼‰" -ForegroundColor Green
            return $true
        }
        
        Write-Host "âš ï¸ é‡è¤‡æ¤œå‡ºï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³æ•°: $obsidianToAnkiCountï¼‰" -ForegroundColor Yellow
        
        # æœ€åˆã®Obsidian_to_Ankiã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿æŒã—ã€ä»–ã‚’å‰Šé™¤
        $sections = $content -split "# Obsidian_to_Anki"
        
        if ($sections.Count -ge 3) {
            # æœ€åˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰+ æœ€åˆã®Obsidian_to_Ankiã‚»ã‚¯ã‚·ãƒ§ãƒ³
            $firstSection = $sections[0]
            $firstObsidianSection = $sections[1]
            
            # ENDãƒãƒ¼ã‚«ãƒ¼ã¾ã§ã‚’æŠ½å‡º
            if ($firstObsidianSection -match "(.*?END)") {
                $cleanObsidianSection = $matches[1]
                $newContent = $firstSection + "# Obsidian_to_Anki" + $cleanObsidianSection + "`n"
                
                Set-Content $FilePath -Value $newContent -NoNewline -Encoding UTF8
                Write-Host "âœ… é‡è¤‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤å®Œäº†ï¼ˆ$($obsidianToAnkiCount-1) å€‹å‰Šé™¤ï¼‰" -ForegroundColor Green
                return $true
            }
        }
        
        Write-Host "âŒ é‡è¤‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¿®æ­£å¤±æ•—ï¼ˆè¤‡é›‘ãªæ§‹é€ ï¼‰" -ForegroundColor Red
        return $false
        
    } catch {
        Write-Host "âŒ é‡è¤‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¿®æ­£ã‚¨ãƒ©ãƒ¼: $($_.Exception.Message)" -ForegroundColor Red
        return $false
    }
}

# ä½¿ç”¨ä¾‹
# Fix-DuplicateObsidianToAnkiSections "back-èƒŒä¸­.md"
```
