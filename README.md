# eigo-kanyoku - 英語慣用句・句動詞学習プロジェクト

## プロジェクト概要

英語の慣用句・句動詞を体系的に整理し、TOEIC学習に特化したObsidian + Anki連携による効率的な学習システムです。

### 主な特徴

- **TOEIC特化**: TOEIC Part別出題傾向と頻出度レベルによる分類
- **Obsidian_to_Anki連携**: 専用形式でのAnkiカード自動生成
- **体系的分類**: 慣用句・句動詞・ビジネス表現の詳細分類
- **相互参照システム**: 関連表現間の包括的なリンク構造

## 学習コンテンツ

### 現在の収録表現
- **back関連表現**: 22個の慣用句・句動詞
- **基本単語**: backを中心とした表現集
- **実用文例**: TOEIC優先度順での効率的学習

### ファイル構成
```
eigo-kanyoku/
├── back-*.md                    # back関連の各表現ファイル
├── tango/                       # 単語学習関連
├── script/                      # PowerShell検証スクリプト
└── .cursor/rules/               # プロジェクト管理ルール
```

## Obsidian_to_Anki連携

### 対応形式
```markdown
# Obsidian_to_Anki

START
Basic
表現: cut back
意味: 削減する、縮小する
文例: The company decided to cut back on expenses.
END
```

### 自動生成機能
- ID自動付与: `<!--ID: 数値-->`
- デッキ分類: TOEIC Part別・頻出度別
- カードタイプ: Basic/Cloze/WithSpeech対応

## ルール体系（2025年06月更新）

### 最新の主要改善（2025年06月22日）

#### 202番ルール形式標準化とObsidian_to_Anki最適化
**背景**: back-and-forthファイルで発見された新しいAnkiラベル配置形式の全体統一

**実装成果**:
- **202-Obsidian_to_Anki独自形式管理.mdc**: Ankiラベル位置の標準化
  - 新形式: "Back:"の直後にAnkiラベル配置（視認性向上）
  - 旧形式: TOEIC優先度/Part情報の後にAnkiラベル配置
  - ルール構造・実装例・文書化の全面更新
- **一括適用システム**: PowerShell `Fix-AnkiLabelPosition`関数による自動変換
  - 正規表現パターンマッチングによる精密な位置変更
  - 22ファイル対象（README.md・tangoディレクトリ除外）
  - 100%成功率での形式統一完了
- **品質向上効果**: 
  - Ankiカード作成時の視認性向上
  - Obsidian_to_Ankiプラグインとの連携最適化
  - 学習効率の向上（重要情報の前面配置）

**適用結果**:
- **20ファイル**: 新形式に自動変換完了
- **2ファイル**: 既に新形式適用済み（back-and-forth, turn-ones-back-on）
- **統一達成**: 全22ファイルが新202番ルール形式に統一

#### コミット前README確認システム確立
**背景**: 202ルール適用時にREADME更新を忘れるミスを防止する仕組みが必要

**実装成果**:
- **108-Git操作管理.mdc**: 「README確認・更新フェーズ（必須）」を新設
  - コミット前README確認チェックリスト（6項目の必須確認事項）
  - README更新忘れ防止機能（PowerShell自動判定スクリプト）
  - ルールファイル変更・表現ファイル大量変更時の自動判定
- **Git操作フロー変更**: 1.状況確認 → 2.README確認（新設） → 3.ステージング → 4.コミット → 5.プッシュ
- **ルール連携強化**: 107番（README管理）・006番（Git差分分析）・005番（日付取得）との統合
- **自動化機能**: `Invoke-PreCommitReadmeCheck`関数による変更内容の自動判定

**効果**:
- **ミス防止**: README更新忘れの根本的防止
- **品質向上**: Git差分とREADME記載内容の整合性確保
- **効率化**: 自動判定による更新要否の即座確認

#### 103番重複解消とPowerShell操作統合
**背景**: 103番ルールが2つ存在する重複問題を発見・解決

**解決成果**:
- **重複解消**: 103-プロジェクト共通PowerShell操作.mdc を削除
- **110番統合**: PowerShell関連機能を110-PowerShell操作管理.mdcに統合
  - 安全性確保（エラー予防・デバッグ手法）
  - プロジェクト固有操作（mdファイル一括処理・文字コード統一）
  - 検証フレームワーク（品質基準・一括処理テンプレート）
- **参照更新**: 202, 203, 003, 004ルールの参照を110番に統一
- **機能強化**: 旧103の全機能を110に統合し、PowerShell操作の一元管理を実現

#### 改行コード管理システムの確立
**背景**: Git操作時の"LF will be replaced by CRLF"警告とmdファイルの改行コード統一

**実装成果**:
- **107-README管理.mdc**: 改行コード管理セクション追加
  - mdファイル: LF改行で統一（Git設定による自動変換回避）
  - mdcファイル: システム標準（通常CRLF）
  - 110番ルール活用による改行コード統一処理
- **.gitattributes**: 新規作成による改行コード制御
  - `*.md text eol=lf`: mdファイルのLF改行固定
  - `*.mdc text eol=auto`: mdcファイルの自動判定
  - バイナリファイル・PowerShellスクリプトの適切な設定
- **Git操作時の注意事項**: コミット前チェック・警告対応手順の明確化

#### Git差分統合システムとルール体系3層構造化
**背景**: README更新プロセスの自動化とルール体系の汎用性向上を実現

**実装成果**:
- **005-日付取得管理.mdc**: 動的日付取得の標準化ルール新規作成
  - README更新用: yyyy年MM月dd日形式
  - フロントマター用: yyyy-MM-dd形式  
  - 差分なし更新の禁止制約追加
- **006-Git差分分析管理.mdc**: 汎用Git差分分析機能新規作成
  - 基本変更サマリー・ファイル種別別分析・変更規模分析関数
  - ドキュメント更新判定の自動化
  - 004-PowerShell操作ガイド参照によるPSReadLine無効化統合
- **107-README管理.mdc**: Git差分統合とREADME管理専門化
  - 006ルール参照によるGit差分ベース更新プロセス確立
  - 必須Git差分確認の手順化
- **108-Git操作管理.mdc**: プロジェクト特化Git操作分離
  - 汎用機能を006に移譲、TOEIC/Anki特化機能に集中

#### ルール体系の3層構造化完成
```
汎用レベル (006): Git差分分析の基本機能
    ↓
プロジェクト共通 (108): eigo-kanyoku固有のGit操作  
    ↓
専門レベル (107): README管理の専門機能
```

### 過去の主要改善

#### PowerShell操作の根本的改善（2024年12月最新）
**背景**: AIエージェントからのPowerShell操作でPSReadLineエラーが頻発し、検証作業が中断される問題を発見・解決

**解決成果**:
- **根本原因特定**: PSReadLineのBufferHeight制限（BufferHeight: 1）によるカーソル位置計算エラー
- **完全解決策**: AIエージェント専用PSReadLine無効化設定を004-PowerShell操作ガイドに追加
- **劇的な効果実証**: `Remove-Module PSReadLine`により全てのPSReadLineエラーが完全消失
- **検証完了**: 202番ルール検証を22ファイル全てで正常完了
- **プラグイン最適化**: main.jsのデバッグログ無効化によりパフォーマンス向上

#### Obsidian_to_Anki連携の完全安定化
**背景**: ENDマーカー後のスペース問題と改行コード混在問題を発見・解決

**解決成果**:
- **問題特定**: 正規表現マッチング失敗の根本原因を特定
- **一括修正**: 22ファイル中20ファイルの問題を自動検出・修正
- **予防策確立**: PowerShell検証スクリプトによる品質管理
- **品質保証**: 202番ルール検証で全22ファイルが品質基準を満たすことを確認

#### ルール体系の3層構造化
1. **汎用レベル** (004番): 基本的なPowerShell操作
2. **プロジェクト共通** (103番): eigo-kanyoku固有の操作
3. **専門レベル** (203番): Obsidian_to_Anki特化操作

### 主要ルール概要

| ルール番号 | 名称 | 役割 |
|-----------|------|------|
| 001 | AI実装ガイドライン | AIエージェントの基本制約・安全性確保 |
| 004 | PowerShell操作ガイド | 汎用PowerShell操作のベストプラクティス |
| 005 | 日付取得管理 | 動的日付取得の標準化・差分なし更新禁止 |
| 006 | Git差分分析管理 | 汎用Git差分分析・ドキュメント更新判定 |
| 107 | README管理 | Git差分統合README更新・改行コード管理 |
| 108 | Git操作管理 | プロジェクト特化Git操作・TOEIC/Anki連携 |
| 110 | PowerShell操作管理 | PowerShell安全性確保・プロジェクト固有操作（旧103統合） |
| 202 | Obsidian_to_Anki独自形式管理 | Ankiカード作成・管理の専門ルール |

### 技術的成果

#### 202番ルール形式標準化とObsidian_to_Anki最適化（2025年06月最新）
- **Ankiラベル位置標準化**: "Back:"直後配置による視認性向上
- **一括適用システム**: PowerShell `Fix-AnkiLabelPosition`関数による22ファイル自動変換
  - 正規表現パターンマッチング技術による精密変換
  - 100%成功率（20ファイル変換完了、2ファイル既適用）
  - README.md・tangoディレクトリの適切な除外処理
- **学習効率向上**: 重要情報の前面配置によるAnkiカード作成最適化
- **プラグイン連携強化**: Obsidian_to_Ankiプラグインとの互換性向上

#### コミット前README確認システム確立（2025年06月最新）
- **README更新忘れ防止**: 108番ルールに「README確認・更新フェーズ（必須）」新設
- **自動判定機能**: PowerShell `Invoke-PreCommitReadmeCheck`関数による更新要否の自動判定
  - ルールファイル変更検出（.mdcファイル）
  - 表現ファイル大量変更検出（5件以上の.mdファイル変更）
  - Git差分ベースの精密な判定ロジック
- **Git操作フロー改善**: README確認を必須フェーズとして組み込み
- **ルール連携統合**: 107番・006番・005番との自動連携システム

#### 103番重複解消とPowerShell統合（2025年06月）
- **重複問題解決**: 103番ルール2つ存在問題の完全解消
- **110番統合**: PowerShell操作の一元管理実現
  - 安全性確保: エラー予防・デバッグ手法
  - プロジェクト固有: mdファイル一括処理・文字コード統一
  - 検証フレームワーク: 品質基準・一括処理テンプレート
- **参照統一**: 5つのルールファイル（202,203,003,004）の参照を110番に統一
- **改行コード管理**: .gitattributes新規作成によるmdファイルLF改行固定

#### Git差分統合システムの確立（2025年06月）
- **自動化達成**: README更新プロセスのGit差分ベース自動化
- **3層構造**: 汎用(006)→プロジェクト特化(108)→専門(107)の明確な階層
- **日付管理標準化**: 005ルールによる動的日付取得と差分なし更新禁止
- **ドキュメント品質向上**: Git差分に基づく正確な変更記録
- **ルール参照統合**: 004→006→107の依存関係明確化によるPSReadLine安定化

#### PSReadLineエラーの根本的解決（2024年12月）
- **問題**: AIエージェント操作時のPSReadLineエラー頻発（System.ArgumentOutOfRangeException）
- **原因**: BufferHeight: 1制限によるカーソル位置計算失敗
- **解決**: `Remove-Module PSReadLine -Force`による完全無効化
- **効果**: 全てのPSReadLineエラーが完全消失、複雑コマンドの安定実行
- **実装**: 004-PowerShell操作ガイドにAIエージェント専用設定を追加

#### 文字コード・改行コード問題の解決
- **問題**: ENDマーカー後のスペース、改行コード混在（CRLF/LF）
- **解決**: PowerShell自動検証・修正スクリプト
- **予防**: 品質チェック項目の標準化
- **検証**: 202番ルールで全22ファイルの品質基準適合を確認

#### コマンド長制限対応
- **制限**: PowerShellコマンドライン約8192文字
- **対策**: 6000文字での事前分割、スクリプトファイル化
- **自動化**: AI実装時の自動選択基準
- **PSReadLine無効化後**: 制限の影響が大幅に軽減

## 開発環境

### 必要ツール
- **Obsidian**: メイン編集環境
- **Cursor**: AI支援開発環境
- **PowerShell**: 検証・修正スクリプト実行
- **Anki**: 学習カード管理
- **Obsidian_to_Ankiプラグイン**: カード自動生成

### セットアップ
1. Obsidianでワークスペースを開く
2. Obsidian_to_Ankiプラグインをインストール
3. PowerShell実行ポリシーを設定: `Set-ExecutionPolicy RemoteSigned`
4. 検証スクリプトを実行: `. .\script\ObsidianToAnkiValidator.ps1`

## 品質管理

### 自動検証機能
```powershell
# AIエージェント専用: PSReadLine無効化（推奨）
Remove-Module PSReadLine -Force -ErrorAction SilentlyContinue

# 全ファイル一括検証
Test-AllObsidianToAnkiFiles

# 個別ファイル検証
Test-ObsidianToAnkiFile "ファイル名.md"
```

### 最新検証結果（2024年12月）
- **202番ルール検証**: 全22ファイル正常 ✅
- **PSReadLineエラー**: 完全解決 ✅
- **品質基準適合**: 100%達成 ✅

### チェック項目
- ✅ Obsidian_to_Ankiセクション存在
- ✅ START/END形式の正確性
- ✅ ENDマーカー後のスペース除去
- ✅ 改行コード統一（LF）
- ✅ 文字コード確認（UTF-8）
- ✅ PSReadLineエラー対策（AIエージェント操作時）

## 学習効果

### TOEIC対応
- **Part別分類**: リスニング・リーディング対応
- **頻出度レベル**: スコア帯別重要度
- **実用文例**: ビジネス・日常場面での使用例

### Anki学習最適化
- **効率的復習**: 忘却曲線に基づく復習間隔
- **多角的学習**: 意味・用法・文例の統合学習
- **進捗管理**: 習得状況の可視化

---

**最終更新**: 2025年06月22日  
**主要成果**: 202番ルール形式標準化・コミット前README確認システム確立・103番重複解消・PowerShell操作統合・改行コード管理システム確立

## 今後の展開

### 短期目標
- [ ] back以外の基本単語への拡張
- [ ] 音声学習機能（WithSpeech）の充実
- [ ] TOEIC Part別学習コースの整備

### 中長期目標
- [ ] 他の語学学習プロジェクトへのルール体系適用
- [ ] AI支援による学習コンテンツ自動生成
- [ ] 学習効果測定・分析機能の開発

## 貢献・フィードバック

このプロジェクトは継続的な改善を目指しています。学習効果の向上や技術的改善に関するフィードバックを歓迎します。

---

**最終更新**: 2025年06月22日
**プロジェクト状況**: アクティブ開発中
**主要成果**: 202番ルール形式標準化、コミット前README確認システム確立、Git差分統合システム確立、ルール体系3層構造化、日付管理標準化、README更新プロセス自動化
**最新の技術的突破**: Obsidian_to_Anki形式最適化と一括適用システムの完全自動化 
