# eigo-kanyoku - 英語慣用句・句動詞学習プロジェクト

## プロジェクト概要

英語の慣用句・句動詞を体系的に整理し、TOEIC学習に特化したObsidian + Anki連携による効率的な学習システムです。

### 主な特徴

- **TOEIC特化**: TOEIC Part別出題傾向と頻出度レベルによる分類
- **Obsidian_to_Anki連携**: 専用形式でのAnkiカード自動生成
- **体系的分類**: 慣用句・句動詞・ビジネス表現の詳細分類
- **相互参照システム**: 関連表現間の包括的なリンク構造

## 学習コンテンツ

### 現在の収録表現
- **back関連表現**: 22個の慣用句・句動詞
- **基本単語**: backを中心とした表現集
- **実用文例**: TOEIC優先度順での効率的学習

### ファイル構成
```
eigo-kanyoku/
├── back-*.md                    # back関連の各表現ファイル
├── tango/                       # 単語学習関連
├── script/                      # PowerShell検証スクリプト
└── .cursor/rules/               # プロジェクト管理ルール
```

## Obsidian_to_Anki連携

### 対応形式
```markdown
# Obsidian_to_Anki

START
Basic
表現: cut back
意味: 削減する、縮小する
文例: The company decided to cut back on expenses.
END
```

### 自動生成機能
- ID自動付与: `<!--ID: 数値-->`
- デッキ分類: TOEIC Part別・頻出度別
- カードタイプ: Basic/Cloze/WithSpeech対応

## ルール体系（2025年06月更新）

### 最新の主要改善（2025年06月22日）

#### Git操作制御システム導入と4パターンフロー制御確立
**背景**: AI実装時のGit操作制御とREADME更新忘れ防止の包括的なシステム化が必要

**実装成果**:
- **108-Git操作管理.mdc**: 「🚨 Git操作制御の4パターンフロー」新設
  - パターン1: README更新必要時（コミット指示なし） → 報告のみ、コミット禁止
  - パターン2: README更新済み + コミット指示あり → コミット実施
  - パターン3: コミット指示あり + README更新必要 → 報告・停止
  - パターン4: コミット指示あり + README適切更新済み → コミット継続
- **001-AI実装ガイドライン.mdc**: Git操作制約の絶対制約化
  - 4パターンフロー制御の最優先適用（他の全ルールより優先）
  - 明示的指示の必須化：「コミットして」「プッシュして」の明確な指示が必要
  - README更新権限のユーザー専有化（AIは検出・報告・停止のみ）
  - 作業停止制御：README更新が必要な場合の強制停止
- **107-README管理.mdc**: Git操作連携制御の専門化
  - 108番ルールとの完全連携体制構築
  - README更新タイミングの厳格化（コミット直前のみ）
  - 必須・推奨更新条件の明確化

**技術的実装**:
- **自動判定システム**: PowerShell `Invoke-PreCommitReadmeCheck`関数
  - ルールファイル変更検出（.mdcファイル）
  - 大量コンテンツ変更検出（5件以上の.mdファイル変更）
  - Git差分ベースの精密な判定ロジック
- **フロー制御機能**: PowerShell `Invoke-GitOperationControl`関数
  - 4パターンの自動判定と適切な処理分岐
  - README更新必要性チェックとコミット操作制御
  - パターン別の詳細ログ出力と状況報告
- **ルール間連携**: 108番-001番-107番の3層連携システム
  - 108番: Git操作制御・README必要性判定
  - 001番: AI実行制約・絶対制約事項
  - 107番: README更新プロセス・内容管理

**効果・価値**:
- **安全性向上**: 無許可Git操作の完全防止
- **品質保証**: README更新忘れの根本的防止
- **効率化**: 自動判定による適切なフロー選択
- **一貫性**: AI実装時の統一された動作保証
- **学習効果**: 新規AIセッション時のコンテキスト学習なしでも正確な動作

#### 202番ルール形式標準化とObsidian_to_Anki最適化
**背景**: back-and-forthファイルで発見された新しいAnkiラベル配置形式の全体統一

**実装成果**:
- **202-Obsidian_to_Anki独自形式管理.mdc**: Ankiラベル位置の標準化
  - 新形式: "Back:"の直後にAnkiラベル配置（視認性向上）
  - 旧形式: TOEIC優先度/Part情報の後にAnkiラベル配置
  - ルール構造・実装例・文書化の全面更新
- **一括適用システム**: PowerShell `Fix-AnkiLabelPosition`関数による自動変換
  - 正規表現パターンマッチングによる精密な位置変更
  - 22ファイル対象（README.md・tangoディレクトリ除外）
  - 100%成功率での形式統一完了
- **品質向上効果**: 
  - Ankiカード作成時の視認性向上
  - Obsidian_to_Ankiプラグインとの連携最適化
  - 学習効率の向上（重要情報の前面配置）

**適用結果**:
- **20ファイル**: 新形式に自動変換完了
- **2ファイル**: 既に新形式適用済み（back-and-forth, turn-ones-back-on）
- **統一達成**: 全22ファイルが新202番ルール形式に統一

#### コミット前README確認システム確立（2025年06月22日最新）
- **Git操作制御システムに統合**: 108番ルールの4パターンフロー制御として実装
- **自動判定機能**: PowerShell `Invoke-PreCommitReadmeCheck`関数による更新要否の自動判定
  - ルールファイル変更検出（.mdcファイル）
  - 表現ファイル大量変更検出（5件以上の.mdファイル変更）
  - Git差分ベースの精密な判定ロジック
- **フロー制御統合**: 4パターンフロー制御による完全自動化
  - パターン3: コミット指示あり + README更新必要 → 報告・停止
  - パターン4: コミット指示あり + README適切更新済み → コミット継続
- **ルール連携統合**: 108番・001番・107番との自動連携システム

#### Git差分統合システムとルール体系3層構造化
**背景**: README更新プロセスの自動化とルール体系の汎用性向上を実現

**実装成果**:
- **005-日付取得管理.mdc**: 動的日付取得の標準化ルール新規作成
  - README更新用: yyyy年MM月dd日形式
  - フロントマター用: yyyy-MM-dd形式  
  - 差分なし更新の禁止制約追加
- **006-Git差分分析管理.mdc**: 汎用Git差分分析機能新規作成
  - 基本変更サマリー・ファイル種別別分析・変更規模分析関数
  - ドキュメント更新判定の自動化
  - 004-PowerShell操作ガイド参照によるPSReadLine無効化統合
- **107-README管理.mdc**: Git差分統合とREADME管理専門化
  - 006ルール参照によるGit差分ベース更新プロセス確立
  - 必須Git差分確認の手順化
- **108-Git操作管理.mdc**: プロジェクト特化Git操作分離
  - 汎用機能を006に移譲、TOEIC/Anki特化機能に集中

#### ルール体系の3層構造化完成
```
汎用レベル (006): Git差分分析の基本機能
    ↓
プロジェクト共通 (108): eigo-kanyoku固有のGit操作  
    ↓
専門レベル (107): README管理の専門機能
```

### 過去の主要改善

#### PowerShell操作の根本的改善（2024年12月最新）
**背景**: AIエージェントからのPowerShell操作でPSReadLineエラーが頻発し、検証作業が中断される問題を発見・解決

**解決成果**:
- **根本原因特定**: PSReadLineのBufferHeight制限（BufferHeight: 1）によるカーソル位置計算エラー
- **完全解決策**: AIエージェント専用PSReadLine無効化設定を004-PowerShell操作ガイドに追加
- **劇的な効果実証**: `Remove-Module PSReadLine`により全てのPSReadLineエラーが完全消失
- **検証完了**: 202番ルール検証を22ファイル全てで正常完了
- **プラグイン最適化**: main.jsのデバッグログ無効化によりパフォーマンス向上

#### Obsidian_to_Anki連携の完全安定化
**背景**: ENDマーカー後のスペース問題と改行コード混在問題を発見・解決

**解決成果**:
- **問題特定**: 正規表現マッチング失敗の根本原因を特定
- **一括修正**: 22ファイル中20ファイルの問題を自動検出・修正
- **予防策確立**: PowerShell検証スクリプトによる品質管理
- **品質保証**: 202番ルール検証で全22ファイルが品質基準を満たすことを確認

#### ルール体系の3層構造化
1. **汎用レベル** (004番): 基本的なPowerShell操作
2. **プロジェクト共通** (103番): eigo-kanyoku固有の操作
3. **専門レベル** (203番): Obsidian_to_Anki特化操作

### 主要ルール概要

| ルール番号 | 名称 | 役割 |
|-----------|------|------|
| 001 | AI実装ガイドライン | AIエージェントの基本制約・Git操作制御・4パターンフロー最優先適用 |
| 004 | PowerShell操作ガイド | 汎用PowerShell操作のベストプラクティス |
| 005 | 日付取得管理 | 動的日付取得の標準化・差分なし更新禁止 |
| 006 | Git差分分析管理 | 汎用Git差分分析・ドキュメント更新判定 |
| 107 | README管理 | Git差分統合README更新・改行コード管理・Git操作連携制御 |
| 108 | Git操作管理 | 4パターンフロー制御・README自動判定・TOEIC/Anki特化Git操作 |
| 110 | PowerShell操作管理 | PowerShell安全性確保・プロジェクト固有操作（旧103統合） |
| 202 | Obsidian_to_Anki独自形式管理 | Ankiカード作成・管理の専門ルール |

### 技術的成果

#### Git操作制御システム導入と4パターンフロー制御確立（2025年06月22日最新）
- **4パターンフロー制御**: AI実装時のGit操作を完全制御
  - パターン1-4の自動判定と適切な処理分岐
  - README更新必要性の自動検出と強制停止機能
  - 明示的指示（「コミットして」「プッシュして」）の必須化
- **安全性制約の絶対化**: 001番ルールによる最優先制約適用
  - 無許可Git操作の完全防止
  - README更新権限のユーザー専有化
  - 新規AIセッション時のコンテキスト学習なしでも正確な動作保証
- **ルール間連携システム**: 108番-001番-107番の3層完全連携
  - Git操作制御・AI実行制約・README管理の統合
  - PowerShell関数による自動判定・フロー制御
  - Git差分ベースの精密な更新判定ロジック

#### 202番ルール形式標準化とObsidian_to_Anki最適化（2025年06月最新）
- **Ankiラベル位置標準化**: "Back:"直後配置による視認性向上
- **一括適用システム**: PowerShell `Fix-AnkiLabelPosition`関数による22ファイル自動変換
  - 正規表現パターンマッチング技術による精密変換
  - 100%成功率（20ファイル変換完了、2ファイル既適用）
  - README.md・tangoディレクトリの適切な除外処理
- **学習効率向上**: 重要情報の前面配置によるAnkiカード作成最適化
- **プラグイン連携強化**: Obsidian_to_Ankiプラグインとの互換性向上

#### コミット前README確認システム確立（2025年06月22日最新）
- **Git操作制御システムに統合**: 108番ルールの4パターンフロー制御として実装
- **自動判定機能**: PowerShell `Invoke-PreCommitReadmeCheck`関数による更新要否の自動判定
  - ルールファイル変更検出（.mdcファイル）
  - 表現ファイル大量変更検出（5件以上の.mdファイル変更）
  - Git差分ベースの精密な判定ロジック
- **フロー制御統合**: 4パターンフロー制御による完全自動化
  - パターン3: コミット指示あり + README更新必要 → 報告・停止
  - パターン4: コミット指示あり + README適切更新済み → コミット継続
- **ルール連携統合**: 108番・001番・107番との自動連携システム

#### 103番重複解消とPowerShell統合（2025年06月）
- **重複問題解決**: 103番ルール2つ存在問題の完全解消
- **110番統合**: PowerShell操作の一元管理実現
  - 安全性確保: エラー予防・デバッグ手法
  - プロジェクト固有: mdファイル一括処理・文字コード統一
  - 検証フレームワーク: 品質基準・一括処理テンプレート
- **参照統一**: 5つのルールファイル（202,203,003,004）の参照を110番に統一
- **改行コード管理**: .gitattributes新規作成によるmdファイルLF改行固定

#### Git差分統合システムの確立（2025年06月）
- **自動化達成**: README更新プロセスのGit差分ベース自動化
- **3層構造**: 汎用(006)→プロジェクト特化(108)→専門(107)の明確な階層
- **日付管理標準化**: 005ルールによる動的日付取得と差分なし更新禁止
- **ドキュメント品質向上**: Git差分に基づく正確な変更記録
- **ルール参照統合**: 004→006→107の依存関係明確化によるPSReadLine安定化

#### PSReadLineエラーの根本的解決（2024年12月）
- **問題**: AIエージェント操作時のPSReadLineエラー頻発（System.ArgumentOutOfRangeException）
- **原因**: BufferHeight: 1制限によるカーソル位置計算失敗
- **解決**: `Remove-Module PSReadLine -Force`による完全無効化
- **効果**: 全てのPSReadLineエラーが完全消失、複雑コマンドの安定実行
- **実装**: 004-PowerShell操作ガイドにAIエージェント専用設定を追加

#### 文字コード・改行コード問題の解決
- **問題**: ENDマーカー後のスペース、改行コード混在（CRLF/LF）
- **解決**: PowerShell自動検証・修正スクリプト
- **予防**: 品質チェック項目の標準化
- **検証**: 202番ルールで全22ファイルの品質基準適合を確認

#### コマンド長制限対応
- **制限**: PowerShellコマンドライン約8192文字
- **対策**: 6000文字での事前分割、スクリプトファイル化
- **自動化**: AI実装時の自動選択基準
- **PSReadLine無効化後**: 制限の影響が大幅に軽減

## 開発環境

### 必要ツール
- **Obsidian**: メイン編集環境
- **Cursor**: AI支援開発環境
- **PowerShell**: 検証・修正スクリプト実行
- **Anki**: 学習カード管理
- **Obsidian_to_Ankiプラグイン**: カード自動生成

### セットアップ
1. Obsidianでワークスペースを開く
2. Obsidian_to_Ankiプラグインをインストール
3. PowerShell実行ポリシーを設定: `Set-ExecutionPolicy RemoteSigned`
4. 検証スクリプトを実行: `. .\script\ObsidianToAnkiValidator.ps1`

## 品質管理

### 自動検証機能
```powershell
# AIエージェント専用: PSReadLine無効化（推奨）
Remove-Module PSReadLine -Force -ErrorAction SilentlyContinue

# 全ファイル一括検証
Test-AllObsidianToAnkiFiles

# 個別ファイル検証
Test-ObsidianToAnkiFile "ファイル名.md"
```

### 最新検証結果（2024年12月）
- **202番ルール検証**: 全22ファイル正常 ✅
- **PSReadLineエラー**: 完全解決 ✅
- **品質基準適合**: 100%達成 ✅

### チェック項目
- ✅ Obsidian_to_Ankiセクション存在
- ✅ START/END形式の正確性
- ✅ ENDマーカー後のスペース除去
- ✅ 改行コード統一（LF）
- ✅ 文字コード確認（UTF-8）
- ✅ PSReadLineエラー対策（AIエージェント操作時）

## 学習効果

### TOEIC対応
- **Part別分類**: リスニング・リーディング対応
- **頻出度レベル**: スコア帯別重要度
- **実用文例**: ビジネス・日常場面での使用例

### Anki学習最適化
- **効率的復習**: 忘却曲線に基づく復習間隔
- **多角的学習**: 意味・用法・文例の統合学習
- **進捗管理**: 習得状況の可視化

---

**最終更新**: 2025年06月22日
**プロジェクト状況**: アクティブ開発中
**主要成果**: Git操作制御システム導入・4パターンフロー制御確立・202番ルール形式標準化・コミット前README確認システム確立・Git差分統合システム確立・ルール体系3層構造化・日付管理標準化・README更新プロセス自動化
**最新の技術的突破**: Git操作制御システムの4パターンフロー制御とAI実装時の安全性制約絶対化
